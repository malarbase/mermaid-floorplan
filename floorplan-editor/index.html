<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interactive Floorplan Editor</title>
    <!-- Shared styles from viewer-core (loaded synchronously to avoid FOUC) -->
    <link rel="stylesheet" href="./shared-styles.css">
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        overflow: hidden;
        background: #1a1a1a;
      }
      
      /* Full-screen 3D viewer */
      #app {
        width: 100vw;
        height: 100vh;
      }
      
      /* Editor Panel (collapsible left side) */
      #editor-panel {
        position: absolute;
        top: 0;
        left: 0;
        width: 450px;
        min-width: 300px;
        max-width: 80vw;
        height: 100vh;
        background: #1e1e1e;
        display: flex;
        flex-direction: column;
        transform: translateX(-450px);
        transition: transform 0.3s ease;
        z-index: 200;
        box-shadow: 4px 0 20px rgba(0, 0, 0, 0.3);
      }
      
      #editor-panel.resizing {
        transition: none;
      }
      
      #editor-panel.open {
        transform: translateX(0);
      }
      
      #editor-panel-toggle {
        position: absolute;
        top: 50%;
        right: -40px;
        transform: translateY(-50%);
        width: 40px;
        height: 80px;
        background: #1e1e1e;
        border: none;
        border-radius: 0 8px 8px 0;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff;
        font-size: 16px;
        box-shadow: 4px 0 10px rgba(0, 0, 0, 0.2);
      }
      
      #editor-panel-toggle:hover {
        background: #2d2d2d;
      }
      
      #editor-resize-handle {
        position: absolute;
        top: 0;
        right: -6px;
        width: 12px;
        height: 100%;
        cursor: ew-resize;
        background: transparent;
        z-index: 10;
      }
      
      #editor-resize-handle::before {
        content: '';
        position: absolute;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 4px;
        height: 100%;
        background: transparent;
        transition: background 0.2s;
      }
      
      #editor-resize-handle:hover::before,
      #editor-resize-handle.active::before {
        background: #4a90d9;
      }
      
      #editor-panel-header {
        padding: 12px 16px;
        background: #252526;
        border-bottom: 1px solid #3c3c3c;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
        flex-shrink: 0;
      }
      
      #editor-panel-header h2 {
        font-size: 14px;
        font-weight: 600;
        color: #ccc;
      }
      
      .editor-header-right {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      
      .fp-editor-status {
        font-size: 12px;
        color: #888;
      }
      
      /* Export dropdown */
      .export-dropdown {
        position: relative;
      }
      
      .export-btn {
        background: #3c3c3c;
        border: 1px solid #555;
        color: #ccc;
        padding: 4px 12px;
        border-radius: 4px;
        font-size: 12px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 4px;
      }
      
      .export-btn:hover {
        background: #4a4a4a;
        border-color: #666;
      }
      
      .export-btn::after {
        content: '▾';
        font-size: 10px;
        margin-left: 2px;
      }
      
      .export-menu {
        position: absolute;
        top: 100%;
        right: 0;
        margin-top: 4px;
        background: #2d2d2d;
        border: 1px solid #555;
        border-radius: 4px;
        min-width: 160px;
        z-index: 300;
        display: none;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      }
      
      .export-menu.visible {
        display: block;
      }
      
      .export-menu-item {
        padding: 8px 12px;
        font-size: 12px;
        color: #ccc;
        cursor: pointer;
        border: none;
        background: none;
        width: 100%;
        text-align: left;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      
      .export-menu-item:hover {
        background: #3c3c3c;
      }
      
      .export-menu-item:first-child {
        border-radius: 3px 3px 0 0;
      }
      
      .export-menu-item:last-child {
        border-radius: 0 0 3px 3px;
      }
      
      .export-menu-item .ext {
        color: #888;
        font-size: 11px;
      }
      
      .export-menu-divider {
        height: 1px;
        background: #444;
        margin: 4px 0;
      }
      
      /* Add Room button */
      .add-room-btn {
        background: #2d5a2d;
        border: 1px solid #4a8a4a;
        color: #8f8;
        padding: 4px 12px;
        border-radius: 4px;
        font-size: 12px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 4px;
      }
      
      .add-room-btn:hover {
        background: #3a6a3a;
        border-color: #5a9a5a;
      }
      
      .add-room-btn::before {
        content: '+';
        font-weight: bold;
        font-size: 14px;
      }
      
      /* Dialog styles - use .fp-dialog-* classes from shared-styles.css */
      
      .fp-editor-status.error {
        color: #f44;
      }
      
      .fp-editor-status.success {
        color: #4a4;
      }
      
      #editor-container {
        flex: 1;
        overflow: hidden;
      }
      
      /* 3D viewer - now full screen */
      .viewer-panel {
        position: absolute;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: #1a1a1a;
      }
      
      /* Info panel overlay */
      .info-panel {
        position: absolute;
        top: 16px;
        right: 16px;
        background: rgba(0, 0, 0, 0.85);
        color: white;
        padding: 16px;
        border-radius: 8px;
        font-size: 13px;
        max-width: 280px;
        z-index: 100;
        border: 1px solid #333;
      }
      
      .info-panel h3 {
        margin-bottom: 8px;
        font-size: 12px;
        color: #888;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      
      .info-panel p {
        margin-bottom: 4px;
        color: #ccc;
        font-size: 12px;
      }
      
      .key {
        display: inline-block;
        background: #333;
        padding: 1px 5px;
        border-radius: 3px;
        font-family: monospace;
        font-size: 11px;
        margin: 0 2px;
        border: 1px solid #555;
      }
      
      .mode-toggle {
        margin-top: 10px;
        padding-top: 10px;
        border-top: 1px solid #444;
      }
      
      .mode-toggle label {
        display: flex;
        align-items: center;
        gap: 6px;
        cursor: pointer;
        color: #ccc;
        font-size: 12px;
      }
      
      .mode-toggle input[type="checkbox"] {
        width: 14px;
        height: 14px;
        cursor: pointer;
      }
      
      .mode-indicator {
        margin-top: 6px;
        padding: 4px 8px;
        background: #2a2a2a;
        border-radius: 4px;
        font-size: 11px;
        color: #4a9eff;
      }
      
      /* Control Panel - uses fp-* classes from shared-styles.css for theming */
      /* Only override positioning, not colors (colors come from shared styles) */
      #controls {
        z-index: 100;
      }
      
      /* Unit row layout */
      .unit-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      
      .unit-row select {
        width: 100px;
      }
      
      /* Scrollbar styling for controls */
      #controls::-webkit-scrollbar {
        width: 6px;
      }
      
      #controls::-webkit-scrollbar-track {
        background: #2a2a2a;
        border-radius: 3px;
      }
      
      #controls::-webkit-scrollbar-thumb {
        background: #555;
        border-radius: 3px;
      }
      
      #controls::-webkit-scrollbar-thumb:hover {
        background: #666;
      }
      
      /* 2D Overlay Mini-map - uses .fp-overlay-2d-* classes from shared-styles.css */
      
      /* Panel positioning when editor is open - uses CSS custom properties from shared-styles.css 
       * The shared styles use --layout-editor-width for positioning .fp-overlay-2d, .fp-floor-summary-panel, etc.
       * We set --editor-width on toggle for backward compatibility, and update --layout-editor-width via LayoutManager */
      
      /* Shortcut info panel positioned at bottom-right - doesn't need to move with editor */
      .fp-shortcut-info {
        top: auto !important;
        left: auto !important;
        bottom: 10px;
        right: 320px;  /* Offset from control panel on the right */
      }
      
      body.editor-open .fp-properties-panel {
        left: calc(var(--editor-width, 450px) + 16px);
      }
      
      /* Floor Summary Panel - uses .fp-floor-summary-panel from shared-styles.css */
      
      /* Annotation Labels (CSS2D) - uses shared styles from shared-styles.css */
      
      /* Selection info panel - uses .fp-selection-info from shared-styles.css */
      
      
      /* Error banner */
      .error-banner {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        padding: 8px 16px;
        background: rgba(244, 67, 54, 0.9);
        color: white;
        font-size: 13px;
        z-index: 300;
        display: none;
      }
      
      .error-banner.visible {
        display: block;
      }
      
      /* Error state dimming overlay for 3D scene */
      .error-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.3);
        pointer-events: none; /* Allow clicks to pass through to 3D scene */
        z-index: 150;
        display: none;
        border: 3px solid rgba(244, 67, 54, 0.6);
        box-sizing: border-box;
      }
      
      .error-overlay.visible {
        display: block;
      }
      
      .error-overlay::after {
        content: 'Viewing stale geometry';
        position: fixed;
        bottom: 60px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(244, 67, 54, 0.85);
        color: white;
        padding: 6px 12px;
        border-radius: 4px;
        font-size: 12px;
        white-space: nowrap;
      }
      
      /* Wall selection hint decoration */
      .wall-selection-hint {
        color: #4a9eff;
        font-style: italic;
        margin-left: 8px;
        opacity: 0.9;
      }
      
      /* Hierarchy breadcrumb hint decoration (e.g., "Kitchen › top wall") */
      .hierarchy-breadcrumb-hint {
        color: #88cc88;
        font-style: italic;
        font-size: 11px;
        margin-left: 12px;
        opacity: 0.85;
        background: rgba(136, 204, 136, 0.1);
        padding: 2px 8px;
        border-radius: 4px;
      }
      
      /* Multi-selection highlighting in editor (for 3D multi-select → editor sync) */
      .selected-entity-decoration {
        background-color: rgba(0, 255, 0, 0.15);
        border-radius: 2px;
      }
      
      /* Properties Panel */
      .fp-properties-panel {
        position: absolute;
        top: var(--properties-panel-top, 16px);
        left: 16px;
        background: rgba(0, 0, 0, 0.9);
        color: white;
        border-radius: 8px;
        min-width: 220px;
        max-width: 280px;
        z-index: 95;  /* Below warnings panel (z-index: 100) */
        border: 1px solid #333;
        display: none;
        transition: top 0.3s ease, left 0.3s ease;
      }
      
      .fp-properties-panel-content {
        padding: 12px;
      }
      
      .fp-properties-panel-title {
        font-size: 14px;
        font-weight: 600;
        color: #fff;
        margin-bottom: 12px;
        padding-bottom: 8px;
        border-bottom: 1px solid #444;
      }
      
      .fp-properties-panel-form {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      
      .fp-property-row {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      
      .fp-property-label {
        flex: 0 0 80px;
        font-size: 12px;
        color: #999;
      }
      
      .fp-property-input {
        flex: 1;
        background: #333;
        border: 1px solid #555;
        border-radius: 4px;
        padding: 4px 8px;
        color: #fff;
        font-size: 12px;
        min-width: 0;
      }
      
      .fp-property-input:focus {
        outline: none;
        border-color: #4a9eff;
      }
      
      .fp-property-value.readonly {
        flex: 1;
        color: #888;
        font-size: 12px;
      }
      
      .fp-properties-panel-note {
        margin-top: 12px;
        padding-top: 8px;
        border-top: 1px solid #444;
        font-size: 11px;
        color: #666;
        font-style: italic;
      }
      
      .fp-properties-panel-actions {
        margin-top: 12px;
        padding-top: 12px;
        border-top: 1px solid #444;
        display: flex;
        justify-content: flex-end;
      }
      
      .fp-delete-btn {
        background: #5a2d2d;
        border: 1px solid #8a4a4a;
        color: #f88;
        padding: 6px 12px;
        border-radius: 4px;
        font-size: 12px;
        cursor: pointer;
      }
      
      .fp-delete-btn:hover {
        background: #6a3a3a;
        border-color: #9a5a5a;
      }
      
      /* Confirm dialog styles - use .fp-confirm-dialog-* classes from shared-styles.css */
      
      /* Keyboard Help Overlay */
      #keyboard-help-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.85);
        z-index: 500;
        display: none;
        justify-content: center;
        align-items: center;
      }
      
      .keyboard-help-content {
        background: #2d2d2d;
        border: 1px solid #555;
        border-radius: 12px;
        padding: 24px 32px;
        max-width: 700px;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 8px 32px rgba(0,0,0,0.4);
      }
      
      .keyboard-help-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 12px;
        border-bottom: 1px solid #444;
      }
      
      .keyboard-help-title {
        font-size: 18px;
        font-weight: 600;
        color: #fff;
      }
      
      .keyboard-help-close {
        background: none;
        border: none;
        color: #888;
        font-size: 24px;
        cursor: pointer;
        padding: 4px;
        line-height: 1;
      }
      
      .keyboard-help-close:hover {
        color: #fff;
      }
      
      .keyboard-help-columns {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 24px;
      }
      
      .keyboard-help-section {
        margin-bottom: 16px;
      }
      
      .keyboard-help-section-title {
        font-size: 12px;
        font-weight: 600;
        color: #4a9eff;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 10px;
      }
      
      .keyboard-help-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 4px 0;
      }
      
      .keyboard-help-row .keys {
        display: flex;
        gap: 4px;
      }
      
      .keyboard-help-row .key {
        display: inline-block;
        background: #3c3c3c;
        padding: 3px 8px;
        border-radius: 4px;
        font-family: monospace;
        font-size: 12px;
        border: 1px solid #555;
        color: #fff;
      }
      
      .keyboard-help-row .key-desc {
        color: #aaa;
        font-size: 12px;
      }
      
      .keyboard-help-footer {
        margin-top: 20px;
        padding-top: 12px;
        border-top: 1px solid #444;
        text-align: center;
        color: #666;
        font-size: 11px;
      }
    </style>
  </head>
  <body class="dark-theme">
    <!-- 3D Viewer Panel (full screen) -->
    <div class="viewer-panel" role="region" aria-label="3D Viewer">
      <div id="app" role="application" aria-label="3D floorplan viewer"></div>
    </div>
    
    <!-- Editor Panel (collapsible overlay) -->
    <div id="editor-panel" class="open" role="region" aria-label="Code Editor">
      <div id="editor-resize-handle"></div>
      <button id="editor-panel-toggle" title="Toggle Editor">◀</button>
      <div id="editor-panel-header">
        <h2>Floorplan DSL</h2>
        <div class="editor-header-right">
          <button class="add-room-btn" id="add-room-btn" aria-label="Add new room">Room</button>
          <div class="export-dropdown">
            <button class="export-btn" id="export-btn" aria-haspopup="menu" aria-expanded="false">Export</button>
            <div class="export-menu" id="export-menu">
              <button class="export-menu-item" data-format="dsl">
                Floorplan DSL <span class="ext">.floorplan</span>
              </button>
              <button class="export-menu-item" data-format="json">
                JSON Data <span class="ext">.json</span>
              </button>
              <div class="export-menu-divider"></div>
              <button class="export-menu-item" data-format="glb">
                3D Model (Binary) <span class="ext">.glb</span>
              </button>
              <button class="export-menu-item" data-format="gltf">
                3D Model (Text) <span class="ext">.gltf</span>
              </button>
            </div>
          </div>
          <span id="editor-status" class="fp-editor-status">Ready</span>
        </div>
      </div>
      <div id="editor-container"></div>
    </div>
    
    <!-- Error banners and overlays (positioned over 3D view) -->
    <div class="error-banner" id="error-banner" role="alert" aria-live="polite"></div>
    <div class="error-overlay" id="error-overlay" aria-hidden="true"></div>
    
    <!-- Control Panel -->
        <div id="controls" class="fp-control-panel">
          <!-- Camera Section -->
          <div class="fp-control-section">
            <div class="fp-section-header">Camera</div>
            <div class="fp-section-content">
              <button id="camera-mode-btn" class="fp-btn">Switch to Orthographic</button>
              <button id="isometric-btn" class="fp-btn fp-btn-secondary">Isometric View</button>
              <div class="fp-control-group" id="fov-group">
                <div class="fp-control-row">
                  <label class="fp-label">FOV</label>
                  <span class="fp-slider-value" id="fov-value">75°</span>
                </div>
                <input type="range" id="fov-slider" class="fp-slider" min="30" max="120" value="75" step="1">
              </div>
            </div>
          </div>
          
          <!-- Lighting Section -->
          <div class="fp-control-section collapsed">
            <div class="fp-section-header">Lighting</div>
            <div class="fp-section-content">
              <div class="fp-control-group">
                <div class="fp-control-row">
                  <label class="fp-label">Azimuth</label>
                  <span class="fp-slider-value" id="light-azimuth-value">45°</span>
                </div>
                <input type="range" id="light-azimuth" class="fp-slider" min="0" max="360" value="45" step="1">
              </div>
              <div class="fp-control-group">
                <div class="fp-control-row">
                  <label class="fp-label">Elevation</label>
                  <span class="fp-slider-value" id="light-elevation-value">60°</span>
                </div>
                <input type="range" id="light-elevation" class="fp-slider" min="0" max="90" value="60" step="1">
              </div>
              <div class="fp-control-group">
                <div class="fp-control-row">
                  <label class="fp-label">Intensity</label>
                  <span class="fp-slider-value" id="light-intensity-value">1.0</span>
                </div>
                <input type="range" id="light-intensity" class="fp-slider" min="0" max="2" value="1" step="0.1">
              </div>
            </div>
          </div>
          
          <!-- View Section -->
          <div class="fp-control-section collapsed">
            <div class="fp-section-header">View</div>
            <div class="fp-section-content">
              <div class="fp-control-group">
                <div class="fp-control-row">
                  <label class="fp-label">Theme</label>
                  <button id="theme-toggle-btn" class="fp-btn fp-btn-secondary" style="padding: 4px 12px; font-size: 11px;">☀️ Light</button>
                </div>
              </div>
              <div class="fp-control-group">
                <div class="fp-control-row">
                  <label class="fp-label">Exploded View</label>
                  <span class="fp-slider-value" id="exploded-value">0%</span>
                </div>
                <input type="range" id="exploded-view" class="fp-slider" min="0" max="100" value="0" step="1">
              </div>
            </div>
          </div>
          
          <!-- Floors Section -->
          <div class="fp-control-section">
            <div class="fp-section-header">Floors</div>
            <div class="fp-section-content">
              <div id="floor-list" class="fp-floor-list">
                <div class="fp-no-floors">Floors will appear here</div>
              </div>
              <div class="fp-floor-actions">
                <button id="show-all-floors" class="fp-btn fp-btn-secondary">Show All</button>
                <button id="hide-all-floors" class="fp-btn fp-btn-secondary">Hide All</button>
              </div>
            </div>
          </div>
          
          <!-- 2D Overlay Section -->
          <div class="fp-control-section collapsed">
            <div class="fp-section-header">2D Overlay</div>
            <div class="fp-section-content">
              <div class="fp-checkbox-row">
                <input type="checkbox" id="show-2d-overlay">
                <label for="show-2d-overlay">Show 2D Mini-map</label>
              </div>
              <div class="fp-control-group">
                <div class="fp-control-row">
                  <label class="fp-label">Opacity</label>
                  <span class="fp-slider-value" id="overlay-opacity-value">60%</span>
                </div>
                <input type="range" id="overlay-opacity" class="fp-slider" min="20" max="100" value="60" step="5">
              </div>
            </div>
          </div>
          
          <!-- Annotations Section -->
          <div class="fp-control-section collapsed">
            <div class="fp-section-header">Annotations</div>
            <div class="fp-section-content">
              <div class="fp-checkbox-row">
                <input type="checkbox" id="show-area">
                <label for="show-area">Show Room Areas</label>
              </div>
              <div class="fp-checkbox-row">
                <input type="checkbox" id="show-dimensions">
                <label for="show-dimensions">Show Dimensions</label>
              </div>
              <div class="fp-checkbox-row">
                <input type="checkbox" id="show-floor-summary">
                <label for="show-floor-summary">Show Floor Summary</label>
              </div>
              <div class="unit-row">
                <label class="fp-label">Area Unit</label>
                <select id="area-unit" class="fp-select">
                  <option value="sqft">sq ft</option>
                  <option value="sqm">sq m</option>
                </select>
              </div>
              <div class="unit-row">
                <label class="fp-label">Length Unit</label>
                <select id="length-unit" class="fp-select">
                  <option value="ft" selected>feet</option>
                  <option value="m">meters</option>
                  <option value="cm">centimeters</option>
                  <option value="in">inches</option>
                  <option value="mm">millimeters</option>
                </select>
              </div>
            </div>
          </div>
          
          <!-- Selection Section -->
          <div class="fp-control-section">
            <div class="fp-section-header">Selection</div>
            <div class="fp-section-content">
              <div class="fp-checkbox-row">
                <input type="checkbox" id="selection-enabled" checked>
                <label for="selection-enabled">Enable Selection Mode</label>
              </div>
              <div id="selection-status" style="margin: 8px 0; padding: 6px 10px; background: rgba(0, 255, 0, 0.15); border: 1px solid rgba(0, 255, 0, 0.4); border-radius: 4px; font-size: 11px; color: #0f0;">
                ✓ Selection Mode Active (press V to toggle)
              </div>
              <div class="fp-checkbox-row" style="margin-top: 8px;">
              <input type="checkbox" id="containment-mode">
                <label for="containment-mode">Containment mode</label>
            </div>
              <div class="fp-control-row" style="margin-top: 8px;">
                <span style="font-size: 11px; color: #888;">Marquee mode:</span>
                <span class="fp-slider-value" id="mode-indicator" style="color: #4a9eff;">Intersection</span>
          </div>
              <div style="margin-top: 12px; padding-top: 8px; border-top: 1px solid #444; font-size: 11px; color: #666;">
                Press <span class="fp-kbd" style="margin: 0;">H</span> for shortcuts
              </div>
            </div>
          </div>
        </div>
        
        <!-- 2D Overlay Mini-map Container -->
        <div id="overlay-2d" class="fp-overlay-2d">
          <div id="overlay-2d-header" class="fp-overlay-2d-header">
            <span>2D Floor Plan</span>
            <button id="overlay-2d-close" class="fp-overlay-2d-close" title="Close">×</button>
          </div>
          <div id="overlay-2d-content" class="fp-overlay-2d-content">
            <span id="overlay-2d-empty" class="fp-overlay-2d-empty">2D view will appear here</span>
          </div>
          <div id="overlay-2d-resize" class="fp-overlay-2d-resize"></div>
        </div>
        
        <!-- Floor Summary Panel -->
        <div id="floor-summary" class="fp-floor-summary-panel">
          <div class="floor-summary-title">Floor Summary</div>
          <div id="floor-summary-content"></div>
        </div>
        
        <div id="selection-info" class="fp-selection-info" role="status" aria-live="polite" aria-label="Selection status">
          <div class="details">No selection</div>
        </div>
        
        <!-- Properties Panel (shown when single element selected) -->
        <div id="properties-panel" class="fp-properties-panel" role="complementary" aria-label="Properties panel"></div>
      </div>
    </div>
    
    <!-- Delete Confirm Dialog -->
    <div class="fp-dialog-overlay" id="delete-confirm-dialog">
      <div class="fp-confirm-dialog">
        <div class="fp-confirm-dialog-title">Delete <span id="delete-entity-name"></span>?</div>
        <div class="fp-confirm-dialog-message" id="delete-message"></div>
        <div class="fp-confirm-dialog-warning" id="delete-warning" style="display: none;">
          <div class="fp-confirm-dialog-warning-title">⚠️ This will also delete:</div>
          <ul class="fp-confirm-dialog-warning-list" id="delete-cascade-list"></ul>
        </div>
        <div class="fp-dialog-buttons">
          <button class="fp-dialog-btn fp-dialog-btn-cancel" id="delete-cancel">Cancel</button>
          <button class="fp-dialog-btn fp-dialog-btn-danger" id="delete-confirm">Delete</button>
        </div>
      </div>
    </div>
    
    <!-- Keyboard Help Overlay -->
    <div id="keyboard-help-overlay" role="dialog" aria-label="Keyboard shortcuts" aria-modal="true">
      <div class="keyboard-help-content">
        <div class="keyboard-help-header">
          <h2 class="keyboard-help-title">Keyboard Shortcuts</h2>
          <button class="keyboard-help-close" aria-label="Close">&times;</button>
        </div>
        <div class="keyboard-help-columns">
          <div>
            <div class="keyboard-help-section">
              <div class="keyboard-help-section-title">Navigation</div>
              <div class="keyboard-help-row">
                <div class="keys"><span class="key">W</span><span class="key">A</span><span class="key">S</span><span class="key">D</span></div>
                <span class="key-desc">Pan camera</span>
              </div>
              <div class="keyboard-help-row">
                <div class="keys"><span class="key">Q</span><span class="key">E</span></div>
                <span class="key-desc">Move down / up</span>
              </div>
              <div class="keyboard-help-row">
                <div class="keys"><span class="key">+</span><span class="key">-</span></div>
                <span class="key-desc">Zoom in / out</span>
              </div>
              <div class="keyboard-help-row">
                <div class="keys"><span class="key">Shift</span></div>
                <span class="key-desc">Precision mode</span>
              </div>
            </div>
            <div class="keyboard-help-section">
              <div class="keyboard-help-section-title">Views</div>
              <div class="keyboard-help-row">
                <div class="keys"><span class="key">1</span></div>
                <span class="key-desc">Front view</span>
              </div>
              <div class="keyboard-help-row">
                <div class="keys"><span class="key">3</span></div>
                <span class="key-desc">Right view</span>
              </div>
              <div class="keyboard-help-row">
                <div class="keys"><span class="key">7</span></div>
                <span class="key-desc">Top view</span>
              </div>
              <div class="keyboard-help-row">
                <div class="keys"><span class="key">5</span></div>
                <span class="key-desc">Toggle ortho/perspective</span>
              </div>
            </div>
          </div>
          <div>
            <div class="keyboard-help-section">
              <div class="keyboard-help-section-title">Camera</div>
              <div class="keyboard-help-row">
                <div class="keys"><span class="key">Home</span></div>
                <span class="key-desc">Reset camera</span>
              </div>
              <div class="keyboard-help-row">
                <div class="keys"><span class="key">F</span></div>
                <span class="key-desc">Frame geometry</span>
              </div>
              <div class="keyboard-help-row">
                <div class="keys"><span class="key">C</span></div>
                <span class="key-desc">Center pivot</span>
              </div>
              <div class="keyboard-help-row">
                <div class="keys"><span class="key">P</span></div>
                <span class="key-desc">Toggle pivot indicator</span>
              </div>
            </div>
            <div class="keyboard-help-section">
              <div class="keyboard-help-section-title">Selection</div>
              <div class="keyboard-help-row">
                <div class="keys"><span class="key">Click</span></div>
                <span class="key-desc">Select</span>
              </div>
              <div class="keyboard-help-row">
                <div class="keys"><span class="key">Shift</span><span class="key">Click</span></div>
                <span class="key-desc">Add to selection</span>
              </div>
              <div class="keyboard-help-row">
                <div class="keys"><span class="key">⌘/Ctrl</span><span class="key">A</span></div>
                <span class="key-desc">Select all</span>
              </div>
              <div class="keyboard-help-row">
                <div class="keys"><span class="key">Esc</span></div>
                <span class="key-desc">Deselect</span>
              </div>
            </div>
          </div>
        </div>
        <div class="keyboard-help-footer">
          Press <span class="key" style="background:#333;padding:2px 6px;">H</span> or <span class="key" style="background:#333;padding:2px 6px;">?</span> to toggle this help
        </div>
      </div>
    </div>
    
    <!-- Add Room Dialog -->
    <div class="fp-dialog-overlay" id="add-room-dialog">
      <div class="fp-dialog">
        <div class="fp-dialog-title">Add New Room</div>
        <div class="fp-dialog-field">
          <label for="room-name">Room Name</label>
          <input type="text" id="room-name" placeholder="e.g., Bedroom, Office" autocomplete="off">
        </div>
        <div class="fp-dialog-row">
          <div class="fp-dialog-field">
            <label for="room-x">X Position</label>
            <input type="number" id="room-x" value="0" step="0.5">
          </div>
          <div class="fp-dialog-field">
            <label for="room-y">Y Position</label>
            <input type="number" id="room-y" value="0" step="0.5">
          </div>
        </div>
        <div class="fp-dialog-row">
          <div class="fp-dialog-field">
            <label for="room-width">Width</label>
            <input type="number" id="room-width" value="4" step="0.5" min="0.5">
          </div>
          <div class="fp-dialog-field">
            <label for="room-height">Height</label>
            <input type="number" id="room-height" value="4" step="0.5" min="0.5">
          </div>
        </div>
        <div class="fp-dialog-error" id="add-room-error"></div>
        <div class="fp-dialog-buttons">
          <button class="fp-dialog-btn fp-dialog-btn-cancel" id="add-room-cancel">Cancel</button>
          <button class="fp-dialog-btn fp-dialog-btn-primary" id="add-room-confirm">Add Room</button>
        </div>
      </div>
    </div>
    
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
