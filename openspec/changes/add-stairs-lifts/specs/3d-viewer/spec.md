## ADDED Requirements

### Requirement: 3D Stair Geometry Rendering
The viewer SHALL render stairs with full 3D geometry including treads, risers, handrails, and stringers.

#### Scenario: Straight stair geometry
- **WHEN** a straight stair is defined in the floorplan
- **THEN** the viewer SHALL render individual tread meshes as horizontal boxes
- **AND** riser meshes as vertical planes between treads (unless stringers: open)
- **AND** the treads SHALL follow the specified direction

#### Scenario: L-shaped stair with landing
- **WHEN** an L-shaped stair is defined with a landing
- **THEN** the viewer SHALL render the first flight of steps
- **AND** a horizontal landing platform at the turn
- **AND** the second flight of steps continuing in the new direction

#### Scenario: U-shaped stair geometry
- **WHEN** a U-shaped stair is defined
- **THEN** the viewer SHALL render two parallel flights with a 180Â° landing between them

#### Scenario: Spiral stair geometry
- **WHEN** a spiral stair is defined with `shape spiral`
- **THEN** the viewer SHALL render wedge-shaped treads arranged in a helix
- **AND** treads SHALL rotate around a central pole
- **AND** the rotation direction SHALL match `rotation clockwise|counter-clockwise`

#### Scenario: Custom segmented stair geometry
- **WHEN** a custom stair is defined with flight/turn segments
- **THEN** the viewer SHALL render each flight and turn segment in sequence
- **AND** transitions between segments SHALL be seamless

### Requirement: Stair Handrail Rendering
The viewer SHALL render handrails according to the stair's handrail specification.

#### Scenario: Both-side handrails
- **WHEN** a stair specifies `handrail (both)`
- **THEN** the viewer SHALL render cylindrical handrail geometry on both sides
- **AND** handrails SHALL follow the stair slope
- **AND** newel posts SHALL be placed at the top and bottom of each flight

#### Scenario: Single-side handrail
- **WHEN** a stair specifies `handrail (left)` or `handrail (right)`
- **THEN** the viewer SHALL render a handrail only on the specified side

#### Scenario: No handrails specified
- **WHEN** a stair does not specify handrails
- **THEN** the viewer SHALL render handrails on both sides by default

### Requirement: Stringer Style Rendering
The viewer SHALL render stair stringers according to the specified style.

#### Scenario: Closed stringers
- **WHEN** a stair specifies `stringers closed` or uses the default
- **THEN** riser meshes SHALL be rendered as solid vertical planes between treads

#### Scenario: Open stringers
- **WHEN** a stair specifies `stringers open`
- **THEN** riser meshes SHALL NOT be rendered
- **AND** visible side stringers SHALL support the treads

#### Scenario: Glass stringers
- **WHEN** a stair specifies `stringers glass`
- **THEN** riser meshes SHALL be rendered with translucent material
- **AND** material opacity SHALL allow visibility through risers

### Requirement: 3D Lift Shaft Rendering
The viewer SHALL render lift/elevator shafts in 3D.

#### Scenario: Basic lift shaft
- **WHEN** a lift is defined with size and position
- **THEN** the viewer SHALL render a vertical shaft through the floor
- **AND** shaft walls SHALL use the lift's style or default material

#### Scenario: Lift door openings
- **WHEN** a lift specifies `doors (north, south)`
- **THEN** the viewer SHALL render openings in the shaft walls on specified sides
- **AND** door frames MAY be rendered around openings

#### Scenario: Multi-floor lift shaft
- **GIVEN** a vertical connection linking lifts across floors
- **WHEN** the floorplan is rendered
- **THEN** the lift shaft SHALL extend continuously through all connected floors
- **AND** floor slabs SHALL have holes where the lift passes through

### Requirement: Shared 3D Geometry via floorplan-3d-core
The 3D stair and lift geometry SHALL be generated by the shared `floorplan-3d-core` package, ensuring consistent rendering across all consumers.

#### Scenario: Viewer uses shared stair geometry
- **WHEN** the web viewer renders a stair
- **THEN** it SHALL call `generateStairGeometry()` from `floorplan-3d-core`
- **AND** the returned THREE.Group SHALL be added to the floor group

#### Scenario: MCP server uses shared stair geometry
- **WHEN** the MCP server renders a 3D PNG of a floorplan with stairs
- **THEN** it SHALL call the same `generateStairGeometry()` from `floorplan-3d-core`
- **AND** the rendered image SHALL match the viewer output

#### Scenario: Lift geometry shared
- **WHEN** any consumer renders a lift
- **THEN** it SHALL use `generateLiftGeometry()` from `floorplan-3d-core`

#### Scenario: Consistent rendering across consumers
- **GIVEN** the same floorplan DSL
- **WHEN** rendered by both the web viewer and MCP server
- **THEN** stair and lift geometry SHALL be visually identical
- **AND** only camera/lighting differences may exist

### Requirement: Stair Material Application
The viewer SHALL apply materials to stair components based on style definitions.

#### Scenario: Stair style colors
- **WHEN** a stair specifies `style Circulation`
- **AND** Circulation style defines `floor_color` and `wall_color`
- **THEN** treads SHALL use floor_color
- **AND** risers and stringers SHALL use wall_color

#### Scenario: Default stair materials
- **WHEN** a stair has no explicit style
- **THEN** default materials SHALL be applied
- **AND** treads SHALL use a wood-tone or neutral color
- **AND** materials SHALL respect the current theme (light/dark)

